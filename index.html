<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>MES-AI-A Detail App</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f6ff;
    }

    /* ページ切り替えボタン */
    .nav-bar {
      display: flex;
      gap: 8px;
      padding: 12px 16px;
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
    }
    .nav-btn {
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 13px;
      cursor: pointer;
      background: #e5e7ff;
      color: #374151;
    }
    .nav-btn.active {
      background: #4b6bff;
      color: #ffffff;
    }

    /* 一覧ページ（簡易） */
    #pageList {
      padding: 24px;
    }

    /* ===== 詳細ページ全体 ===== */
    #pageDetail {
      padding: 24px;
    }

    /* 上段：画像｜右に「複数項目＋グラフ」 */
    .detail-grid {
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: 24px;
      align-items: flex-start;
    }

    /* 画像ブロック */
    .detail-image-box {
      width: 100%;
      height: 380px;
      border-radius: 24px;
      background: radial-gradient(circle at top left,#eef1ff,#f6f7ff 60%,#ffffff);
      box-shadow: 0 14px 30px rgba(15,23,42,0.16);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .detail-image-box img {
      max-width: 92%;
      max-height: 340px;
      object-fit: contain;
      border-radius: 18px;
      background: #ffffff;
      box-shadow: 0 8px 22px rgba(15,23,42,0.22);
    }

    /* 右上：複数項目（基本情報） */
    .detail-main-info {
      background: #ffffff;
      border-radius: 20px;
      padding: 18px 20px 16px;
      box-shadow: 0 10px 26px rgba(15,23,42,0.12);
    }
    .detail-brand {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: #9ca3af;
    }
    .detail-title {
      font-size: 22px;
      font-weight: 650;
      margin-top: 4px;
    }
    .detail-rating {
      font-size: 13px;
      color: #f59e0b;
      margin-top: 4px;
    }
    .detail-asin-line {
      font-size: 13px;
      margin-top: 6px;
    }
    .detail-asin-line a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 600;
    }
    .detail-asin-line a:hover {
      text-decoration: underline;
    }
    .detail-cat {
      margin-top: 10px;
      font-size: 13px;
      color: #4b5563;
      line-height: 1.5;
    }
    .detail-warning {
      margin-top: 8px;
      font-size: 12px;
      color: #b45309;
    }
    .detail-warning span {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      background: #fef3c7;
    }
    .detail-meta-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
    }
    .meta-chip {
      padding: 4px 9px;
      border-radius: 999px;
      background: #f3f4ff;
      border: 1px solid #e0e7ff;
      color: #4b5563;
    }
    .detail-toolbar {
      margin-top: 10px;
      display: flex;
      gap: 6px;
      align-items: center;
      font-size: 11px;
      color: #6b7280;
      flex-wrap: wrap;
    }
    .detail-toolbar input {
      border-radius: 999px;
      border: 1px solid #d4d8ea;
      padding: 3px 8px;
      min-width: 120px;
      font-size: 11px;
    }
    .detail-toolbar button {
      border-radius: 999px;
      border: none;
      padding: 4px 10px;
      font-size: 11px;
      background: #4b6bff;
      color: #ffffff;
      cursor: pointer;
    }

    /* 右下：グラフ */
    .graph-box {
      background: #ffffff;
      border-radius: 20px;
      padding: 16px 20px 14px;
      margin-top: 16px;
      box-shadow: 0 8px 22px rgba(15,23,42,0.12);
    }
    .graph-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .graph-title {
      font-size: 13px;
      font-weight: 600;
    }
    .graph-sub {
      font-size: 11px;
      color: #6b7280;
    }
    .graph-toggle-row {
      margin-top: 8px;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .graph-toggle-row label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }
    .graph-toggle-row input {
      width: 13px;
      height: 13px;
    }
    .graph-canvas-wrap {
      height: 340px;
      margin-top: 8px;
    }
    .graph-canvas-wrap canvas {
      width: 100% !important;
      height: 340px !important;
    }
    .graph-note {
      margin-top: 4px;
      font-size: 10px;
      color: #6b7280;
    }

    /* 下段：その他項目（横スクロール） */
    .detail-bottom-scroll {
      margin-top: 24px;
      overflow-x: auto;
    }
    .detail-bottom-scroll::-webkit-scrollbar {
      height: 8px;
    }
    .detail-bottom-scroll::-webkit-scrollbar-thumb {
      background: #c7d2fe;
      border-radius: 999px;
    }
    .bottom-strip {
      display: flex;
      gap: 14px;
      min-width: 100%;
    }
    .info-card {
      min-width: 260px;
      max-width: 340px;
      background: #ffffff;
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: 0 8px 20px rgba(15,23,42,0.10);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .info-card-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .chip-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
    }
    .chip-item {
      padding: 6px 8px;
      border-radius: 9px;
      background: #f3f4ff;
      border: 1px solid #e0e7ff;
    }

    @media (max-width: 980px) {
      .detail-grid {
        grid-template-columns: 1fr;
      }
      .detail-image-box {
        height: 320px;
      }
    }
  </style>
</head>
<body>

<!-- ページ切り替え -->
<div class="nav-bar">
  <button id="btnList" class="nav-btn active">1ページ目（一覧）</button>
  <button id="btnDetail" class="nav-btn">2ページ目（詳細）</button>
</div>

<!-- 一覧ページ（ここは簡易版。あとでテーブルを差し替えてOK） -->
<div id="pageList">
  <h2>一覧ページ（仮）</h2>
  <p>ここにMES-AI-Aの横長テーブルを入れてください。<br>
    今は動作確認用としてシンプルな表示にしています。</p>
  <p>
    <button onclick="showPage('detail')">→ サンプルASINの詳細ページを開く</button>
  </p>
</div>

<!-- 詳細ページ -->
<div id="pageDetail" style="display:none;">
  <div class="detail-page">

    <!-- 上段：画像｜右側に「複数項目＋グラフ」 -->
    <div class="detail-grid">

      <!-- 画像 -->
      <div>
        <div class="detail-image-box">
          <img id="detailHeroImage" src="" alt="Product image">
        </div>
      </div>

      <!-- 右側：上＝基本情報・下＝グラフ -->
      <div>

        <!-- 基本情報（複数項目） -->
        <div class="detail-main-info">
          <div class="detail-brand" id="detailBrand"></div>
          <div class="detail-title" id="detailTitle"></div>
          <div class="detail-rating" id="detailRating"></div>

          <div class="detail-asin-line">
            ASIN：
            <a id="detailAsinLink" href="#" target="_blank" rel="noopener"></a>
          </div>

          <div class="detail-cat" id="detailCategory"></div>
          <div class="detail-warning" id="detailWarning"></div>

          <div class="detail-meta-row" id="detailMetaRow"></div>

          <div class="detail-toolbar">
            <span>表示するASIN：</span>
            <input id="detailAsinInput" type="text" placeholder="B0A0000001">
            <button id="detailAsinApplyBtn">更新</button>
          </div>
        </div>

        <!-- グラフ -->
        <div class="graph-box">
          <div class="graph-header">
            <div>
              <div class="graph-title">需給推移（180日）</div>
              <div class="graph-sub">ランキング / セラー数 / 価格</div>
            </div>
            <div class="graph-sub" id="detailGraphAsinLabel"></div>
          </div>

          <div class="graph-toggle-row">
            <label>
              <input type="checkbox" id="chkDemandSupply" checked>
              《需要＆供給》（ランキング＋セラー数）
            </label>
            <label>
              <input type="checkbox" id="chkSupplyPrice">
              《供給＆価格》（セラー数＋価格）
            </label>
          </div>

          <div class="graph-canvas-wrap">
            <canvas id="detailGraph"></canvas>
          </div>
          <div class="graph-note">
            グラフ上にカーソルを合わせると、その時点のランキング・セラー数・価格がツールチップで表示されます。
          </div>
        </div>

      </div>
    </div>

    <!-- 下段：その他項目を横並びスクロール -->
    <div class="detail-bottom-scroll">
      <div class="bottom-strip">
        <div class="info-card">
          <div class="info-card-title">利益・価格・在庫</div>
          <div class="chip-row" id="detailChipRow1"></div>
        </div>
        <div class="info-card">
          <div class="info-card-title">販売指標</div>
          <div class="chip-row" id="detailChipRow2"></div>
        </div>
        <div class="info-card">
          <div class="info-card-title">物流・コスト</div>
          <div class="chip-row" id="detailChipRow3"></div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* ==========================
   ダミーのASINデータ
   ========================== */
const ASIN_DATA = {
  "B0A0000001": {
    asin: "B0A0000001",
    title: "スーパーアクションヒーロー 5体セット",
    brand: "HEROWORKS",
    rating: "★★★★★ (523件)",
    image: "https://via.placeholder.com/320x320?text=Product+image",
    url: "https://www.amazon.com/dp/B0A0000001",
    categoryParent: "Toys & Games",
    categoryChild: "Action Figures",
    warning: "対象年齢6歳以上 / 小さな部品に注意",
    sku: "HW-HERO-SET-5",
    jan: "4900000000001",
    jpAsin: "B0J0000001",
    fba: "はい",
    price: 39.99,
    profitRate: "26%",
    profit: "1,612円",
    stock: 60,
    s30: 95,
    s90: 260,
    s180: 510,
    pred30: 110,
    size: "32×26×8 cm",
    weight: 1.10,
    shipping: "¥1,120",
    tax: "¥0"
  },
  "B0A0000002": {
    asin: "B0A0000002",
    title: "ウルトラギャラクシーパズル 2000ピース",
    brand: "GalaxyMind",
    rating: "★★★★☆ (312件)",
    image: "https://via.placeholder.com/320x320?text=Puzzle",
    url: "https://www.amazon.com/dp/B0A0000002",
    categoryParent: "Toys & Games",
    categoryChild: "Jigsaw Puzzles",
    warning: "対象年齢12歳以上",
    sku: "GM-PUZZLE-2000",
    jan: "4900000000002",
    jpAsin: "B0J0000002",
    fba: "はい",
    price: 26.50,
    profitRate: "30%",
    profit: "1,260円",
    stock: 45,
    s30: 70,
    s90: 190,
    s180: 370,
    pred30: 80,
    size: "28×22×6 cm",
    weight: 0.9,
    shipping: "¥900",
    tax: "¥0"
  }
};

/* ランダムっぽいグラフデータを生成 */
function createSeries(seedText) {
  let seed = 0;
  for (let i = 0; i < seedText.length; i++) seed += seedText.charCodeAt(i);
  function rnd() {
    seed = (seed * 9301 + 49297) % 233280;
    return seed / 233280;
  }

  const days = 180;
  const labels = [];
  const rank = [];
  const sellers = [];
  const price = [];

  let r = 60000;
  let s = 5;
  let p = 35;

  for (let i = 0; i < days; i++) {
    labels.push(`${i + 1}日`);
    r += (rnd() - 0.5) * 4000;
    r = Math.max(5000, Math.min(80000, r));
    s += (rnd() - 0.5) * 2;
    s = Math.max(1, Math.min(20, s));
    p += (rnd() - 0.5) * 1.6;
    p = Math.max(10, Math.min(80, p));
    rank.push(Math.round(r));
    sellers.push(Number(s.toFixed(1)));
    price.push(Number(p.toFixed(2)));
  }
  return { labels, rank, sellers, price };
}

/* ==========================
   ページ切り替え
   ========================== */
const pageList = document.getElementById("pageList");
const pageDetail = document.getElementById("pageDetail");
const btnList = document.getElementById("btnList");
const btnDetail = document.getElementById("btnDetail");

function showPage(which) {
  if (which === "detail") {
    pageList.style.display = "none";
    pageDetail.style.display = "block";
    btnList.classList.remove("active");
    btnDetail.classList.add("active");
    // デフォルト ASIN
    renderDetail("B0A0000001");
  } else {
    pageList.style.display = "block";
    pageDetail.style.display = "none";
    btnDetail.classList.remove("active");
    btnList.classList.add("active");
  }
}
btnList.addEventListener("click", () => showPage("list"));
btnDetail.addEventListener("click", () => showPage("detail"));

/* ==========================
   詳細ページの描画
   ========================== */
const imgEl = document.getElementById("detailHeroImage");
const brandEl = document.getElementById("detailBrand");
const titleEl = document.getElementById("detailTitle");
const ratingEl = document.getElementById("detailRating");
const asinLinkEl = document.getElementById("detailAsinLink");
const catEl = document.getElementById("detailCategory");
const warnEl = document.getElementById("detailWarning");
const metaRowEl = document.getElementById("detailMetaRow");
const chip1El = document.getElementById("detailChipRow1");
const chip2El = document.getElementById("detailChipRow2");
const chip3El = document.getElementById("detailChipRow3");
const graphAsinLabel = document.getElementById("detailGraphAsinLabel");
const detailAsinInput = document.getElementById("detailAsinInput");
const detailAsinApplyBtn = document.getElementById("detailAsinApplyBtn");
const chkDemandSupply = document.getElementById("chkDemandSupply");
const chkSupplyPrice = document.getElementById("chkSupplyPrice");

let detailChart = null;

function renderDetail(asinRaw) {
  const asin = (asinRaw || "").trim().toUpperCase();
  const data = ASIN_DATA[asin] || ASIN_DATA["B0A0000001"];
  if (!data) return;

  imgEl.src = data.image;
  brandEl.textContent = data.brand;
  titleEl.textContent = data.title;
  ratingEl.textContent = data.rating;
  asinLinkEl.textContent = data.asin;
  asinLinkEl.href = data.url;
  catEl.innerHTML =
    `【カテゴリ】<br>親：${data.categoryParent}<br>子：${data.categoryChild}`;
  warnEl.innerHTML = data.warning ? `<span>${data.warning}</span>` : "";

  metaRowEl.innerHTML = "";
  const metaItems = [
    `SKU: ${data.sku}`,
    `JAN: ${data.jan}`,
    `日本ASIN: ${data.jpAsin}`,
    `FBA出品: ${data.fba}`
  ];
  metaItems.forEach(t => {
    const span = document.createElement("span");
    span.className = "meta-chip";
    span.textContent = t;
    metaRowEl.appendChild(span);
  });

  chip1El.innerHTML = `
    <div class="chip-item">販売額（ドル）：$${data.price}</div>
    <div class="chip-item">粗利益率：${data.profitRate}</div>
    <div class="chip-item">粗利益：${data.profit}</div>
    <div class="chip-item">在庫数：${data.stock}</div>
  `;
  chip2El.innerHTML = `
    <div class="chip-item">30日販売数：${data.s30}</div>
    <div class="chip-item">90日販売数：${data.s90}</div>
    <div class="chip-item">180日販売数：${data.s180}</div>
    <div class="chip-item">予測30日販売数：${data.pred30}</div>
  `;
  chip3El.innerHTML = `
    <div class="chip-item">サイズ：${data.size}</div>
    <div class="chip-item">重量：${data.weight} kg</div>
    <div class="chip-item">送料：${data.shipping}</div>
    <div class="chip-item">関税：${data.tax}</div>
  `;

  graphAsinLabel.textContent = `ASIN: ${data.asin}`;
  detailAsinInput.value = data.asin;

  const series = createSeries(data.asin);
  drawDetailChart(series);

  chkDemandSupply.checked = true;
  chkSupplyPrice.checked = false;
  applyDetailCheckbox();
}

function drawDetailChart(series) {
  const ctx = document.getElementById("detailGraph").getContext("2d");
  if (detailChart) detailChart.destroy();

  detailChart = new Chart(ctx, {
    type: "line",
    data: {
      labels: series.labels,
      datasets: [
        {
          label: "ランキング（小さいほど上位）",
          data: series.rank,
          borderColor: "#60a5fa",
          tension: 0.25,
          borderWidth: 2,
          pointRadius: 0,
          yAxisID: "yRank"
        },
        {
          label: "セラー数",
          data: series.sellers,
          borderColor: "#22c55e",
          tension: 0.25,
          borderWidth: 2,
          pointRadius: 0,
          yAxisID: "ySeller"
        },
        {
          label: "価格（USD）",
          data: series.price,
          borderColor: "#f97316",
          tension: 0.25,
          borderWidth: 2,
          pointRadius: 0,
          yAxisID: "yPrice"
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: "index", intersect: false },
      plugins: {
        legend: { position: "top" },
        tooltip: {
          callbacks: {
            label: (ctx) => {
              const label = ctx.dataset.label || "";
              if (ctx.dataset.yAxisID === "yPrice") {
                return `${label}: $${ctx.parsed.y.toFixed(2)}`;
              }
              return `${label}: ${ctx.parsed.y}`;
            }
          }
        }
      },
      scales: {
        x: { display: true, ticks: { maxTicksLimit: 10 } },
        yRank: {
          type: "linear",
          position: "left",
          reverse: true,
          title: { display: true, text: "ランキング" }
        },
        ySeller: {
          type: "linear",
          position: "right",
          grid: { drawOnChartArea: false },
          title: { display: true, text: "セラー数" }
        },
        yPrice: {
          type: "linear",
          position: "right",
          offset: true,
          grid: { drawOnChartArea: false },
          title: { display: true, text: "価格(USD)" }
        }
      }
    }
  });
}

/* チェックボックスで表示線を切り替え */
function applyDetailCheckbox() {
  if (!detailChart) return;
  const demandOn = chkDemandSupply.checked;
  const supplyOn = chkSupplyPrice.checked;

  let showRank = true;
  let showSeller = true;
  let showPrice = true;

  if (demandOn && !supplyOn) {
    // 《需要＆供給》のみ → ランク＋セラー
    showRank = true; showSeller = true; showPrice = false;
  } else if (!demandOn && supplyOn) {
    // 《供給＆価格》のみ → セラー＋価格
    showRank = false; showSeller = true; showPrice = true;
  } else if (demandOn && supplyOn) {
    // 両方ON → 3本全部
    showRank = true; showSeller = true; showPrice = true;
  } else {
    // 両方OFF → 一応全部表示
    showRank = true; showSeller = true; showPrice = true;
  }

  detailChart.data.datasets[0].hidden = !showRank;
  detailChart.data.datasets[1].hidden = !showSeller;
  detailChart.data.datasets[2].hidden = !showPrice;
  detailChart.update();
}

chkDemandSupply.addEventListener("change", applyDetailCheckbox);
chkSupplyPrice.addEventListener("change", applyDetailCheckbox);

/* ASIN入力から更新 */
detailAsinApplyBtn.addEventListener("click", () => {
  renderDetail(detailAsinInput.value);
});
detailAsinInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    renderDetail(detailAsinInput.value);
  }
});

/* 初期表示：一覧ページ */
showPage("list");
</script>
</body>
</html>
